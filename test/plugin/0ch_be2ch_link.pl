#============================================================================================================
#
#	拡張機能 - Be.2chリンク表示
#	0ch_be2ch_link.pl ver.20071117
#	by uuuss ◆uuussBh4TI ( uuussatm@gmail.com / http://afox.s206.xrea.com/ )
#	---------------------------------------------------------------------------
#	ライセンスについて
#	ライセンスは、ぜろちゃんねる(test070124)と同じです。
#	以下は、ぜろちゃんねる(test070124)配布アーカイブ/readme/readme.txtからの引用です。
#	
#	　本スクリプトは自由に改造・再配布してもらってかまいません。また、本スクリ
#	プトによって出力されるクレジット表示(バージョン表示)などの表示も消して使用
#	してもらっても構いません。
#	　ただし、作者は本スクリプトと付属ファイルに関する著作権を放棄しません。
#	　また、作者は本スクリプト使用に関して発生したいかなるトラブルにも責任を負
#	いかねますのでご了承ください。
#
#	引用ここまで。
#	---------------------------------------------------------------------------
#	動作確認済バージョン test070124
#	---------------------------------------------------------------------------
#	DATにBe.2chのIDが入ってたらそれをBe.2chのプロフィールへのリンクに置き換えます
#	---------------------------------------------------------------------------
#	2007.11.16 start
#	2007.11.17 株優プチもちゃんとリンクしてみる、ついでに旧式リンクにも対応
#
#============================================================================================================
package ZPL_be2ch_link;

#------------------------------------------------------------------------------------------------------------
#
#	コンストラクタ
#	-------------------------------------------------------------------------------------
#	@param	なし
#	@return	オブジェクト
#
#------------------------------------------------------------------------------------------------------------
sub new
{
	my $this = shift;
	my $obj={};
	bless($obj,$this);
	return $obj;
}

#------------------------------------------------------------------------------------------------------------
#
#	拡張機能名称取得
#	-------------------------------------------------------------------------------------
#	@param	なし
#	@return	名称文字列
#
#------------------------------------------------------------------------------------------------------------
sub getName
{
	my	$this = shift;
	return 'Be.2chリンク表\示';
}

#------------------------------------------------------------------------------------------------------------
#
#	拡張機能説明取得
#	-------------------------------------------------------------------------------------
#	@param	なし
#	@return	説明文字列
#
#------------------------------------------------------------------------------------------------------------
sub getExplanation
{
	my	$this = shift;
	return 'Be.2chのプロフリンクを表\示';
}

#------------------------------------------------------------------------------------------------------------
#
#	拡張機能タイプ取得
#	-------------------------------------------------------------------------------------
#	@param	なし
#	@return	拡張機能タイプ(スレ立て:1,レス:2,read:4,index:8)
#
#------------------------------------------------------------------------------------------------------------
sub getType
{
	my	$this = shift;
	return (4 | 8);
}

#------------------------------------------------------------------------------------------------------------
#
#	拡張機能実行インタフェイス
#	-------------------------------------------------------------------------------------
#	@param	$sys	MELKOR
#	@param	$form	SAMWISE
#	@param	$mode	拡張機能タイプ
#	@return	正常終了の場合は0
#
#------------------------------------------------------------------------------------------------------------
sub execute
{
	my $this = shift;
	my ($sys,$form,$mode) = @_;
	
	# HTMLだけでやる版 (これは参照元URLが入りません)
	# $sys->Get('_DAT_')->[2] =~ s#BE:(\d+)-([^(]+\(\d+\)( 株優プチ\([0-9a-zA-Z]+\))?|\#*?)#<a href="http://be.2ch.net/test/p.php?i=$1" target=new>?$2</a>#;
	# 旧Be板用
	# $sys->Get('_DAT_')->[2] =~ s#<BE:(\d+):(\d)>#<a href="http://be.2ch.net/test/p.php?i=$1" target=new>LV.$2</a>#;
	
	# ２ちゃんねると同じ版 (要外部JavaScript)
	# $sys->Get('_DAT_')->[2] =~ s#BE:(\d+)-([^(]+\(\d+\)( 株優プチ\([0-9a-zA-Z]+\))?|\#*?)#<a href="javascript:be($1);">?$2</a>#;
	# 旧Be板用
	# $sys->Get('_DAT_')->[2] =~ s#<BE:(\d+):(\d)>#<a href="javascript:be($1);">LV.$2</a>#;
	
	# JavaScriptでやるけど外部スクリプト使わない版
	$sys->Get('_DAT_')->[2] =~ s#BE:(\d+)-([^(]+\(\d+\)( 株優プチ\([0-9a-zA-Z]+\))?|\#*?)#<a href="javascript:w=window.open('http://be.2ch.net/test/p.php?i=$1&amp;u=d:'+document.URL);w.focus();">?$2</a>#;
	# 旧Be板用
	# $sys->Get('_DAT_')->[2] =~ s#<BE:(\d+):(\d)>#<a href="javascript:w=window.open('http://be.2ch.net/test/p.php?i=$1&u=d:'+document.URL);w.focus();">LV.$2</a>#;
	
	return 0;
}

#============================================================================================================
#	Module END
#============================================================================================================
1;
